#include "keyboard.hpp"

// スキャンコード(Set 1) の最大値+1 (主要キーのみ)
const int kKeyMapSize = 0x7d + 1;

// ==========================================
// US配列 (ANSI)
// ==========================================
// 通常時
static const char kKeyMapUS[kKeyMapSize] = {
    0, 0, '1', '2', '3', '4', '5', '6', '7', '8', '9', '0', '-', '=', 0, /* 0x00-0x0E */
    0, 'q', 'w', 'e', 'r', 't', 'y', 'u', 'i', 'o', 'p', '[', ']', '\n', /* 0x0F-0x1C */
    0, 'a', 's', 'd', 'f', 'g', 'h', 'j', 'k', 'l', ';', '\'', '`',      /* 0x1D-0x28 */
    0, '\\', 'z', 'x', 'c', 'v', 'b', 'n', 'm', ',', '.', '/', 0,        /* 0x29-0x36 */
    '*', 0, ' ', 0                                                       /* 0x37-0x3A */
    // ... F1~F12などは0 (省略)
};

// Shift押下時
static const char kKeyMapUS_Shift[kKeyMapSize] = {
    0, 0, '!', '@', '#', '$', '%', '^', '&', '*', '(', ')', '_', '+', 0,
    0, 'Q', 'W', 'E', 'R', 'T', 'Y', 'U', 'I', 'O', 'P', '{', '}', '\n',
    0, 'A', 'S', 'D', 'F', 'G', 'H', 'J', 'K', 'L', ':', '"', '~',
    0, '|', 'Z', 'X', 'C', 'V', 'B', 'N', 'M', '<', '>', '?', 0,
    '*', 0, ' ', 0};

// ==========================================
// 日本語配列 (JIS)
// ==========================================
// 通常時
static const char kKeyMapJP[kKeyMapSize] = {
    0, 0, '1', '2', '3', '4', '5', '6', '7', '8', '9', '0', '-', '^', 0, /* 0x0E: ^ */
    0, 'q', 'w', 'e', 'r', 't', 'y', 'u', 'i', 'o', 'p', '@', '[', '\n', /* 0x1A: @, 0x1B: [ */
    0, 'a', 's', 'd', 'f', 'g', 'h', 'j', 'k', 'l', ';', ':', 0,         /* 0x27: :, 0x28: 全角半角 */
    0, ']', 'z', 'x', 'c', 'v', 'b', 'n', 'm', ',', '.', '/', 0,         /* 0x2B: ] */
    '*', 0, ' ', 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,                           /* ... */
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,                            /* 0x4F: \ (Ro) */
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,                            /* ... */
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,                      /* ... */
    0, 0, 0, '\\', 0, 0, 0, 0, 0, 0, 0, 0, 0, '\\'                       /* 0x73: \, 0x7D: \ (Yen) */
};

// Shift押下時
static const char kKeyMapJP_Shift[kKeyMapSize] = {
    0, 0, '!', '"', '#', '$', '%', '&', '\'', '(', ')', 0, '=', '~', 0,
    0, 'Q', 'W', 'E', 'R', 'T', 'Y', 'U', 'I', 'O', 'P', '`', '{', '\n',
    0, 'A', 'S', 'D', 'F', 'G', 'H', 'J', 'K', 'L', '+', '*', 0,
    0, '}', 'Z', 'X', 'C', 'V', 'B', 'N', 'M', '<', '>', '?', 0,
    '*', 0, ' ', 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, '_', 0, 0, 0, 0, 0, 0, 0, 0, 0, '|' /* 0x73: _, 0x7D: \ (Yen) */};

char ConvertScanCodeToAscii(uint8_t scancode, bool shift, KeyboardLayout layout)
{
    // 範囲外チェック
    if (scancode >= kKeyMapSize)
        return 0;

    if (layout == KeyboardLayout::US_Standard)
    {
        if (shift)
            return kKeyMapUS_Shift[scancode];
        else
            return kKeyMapUS[scancode];
    }
    else
    {
        if (shift)
            return kKeyMapJP_Shift[scancode];
        else
            return kKeyMapJP[scancode];
    }
}